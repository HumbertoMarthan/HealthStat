<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:sec="http://www.springframework.org/security/facelets/tags"
	xmlns:util="http://java.sun.com/jsf/composite/componentes"
	xmlns:p="http://primefaces.org/ui">
<body>
	<p:panel rendered="#{contasReceberBean.estado eq 'P'}">
		<div class="content">
			<div class="ui-fluid">
				<p:panel header="Pesquisa de Pacientes" style="text-align:center">
					<div class="ui-g">
						<h:panelGroup id="botoes">
							<!-- Botão Pagamento -->
							<p:commandButton value="Pagamento"
								actionListener="#{contasReceberBean.setarVariaveisNulas}"
								rendered="#{contasReceberBean.contasReceberModel.status eq 'P' and (
										contasReceberBean.contasReceberModel.idContasReceber > 0)}"
								style="height:40px;width:170px; 
								background-color: darkcyan; background: darkcyan; color:white !important"
								ajax="true" immediate="true" id="buttonPagamento"
								icon="fa fa-info-circle" iconPos="right"
								oncomplete="PF('relancarPagamento').show()" update=":formulario">
								<f:setPropertyActionListener value="#{d}"
									target="#{contasReceberBean.contasReceberModel}" />
							</p:commandButton>

							<p:commandButton
								style="height:40px;width:170px; 
								background-color: blue; background: blue; color:white !important"
								value="Editar Pagamento" update=":relancarForm"
								rendered="#{contasReceberBean.contasReceberModel.status eq 'L'  and
											(contasReceberBean.contasReceberModel.idContasReceber > 0)}"
								onclick="PF('relancarPagamento').show()">
							</p:commandButton>
						</h:panelGroup>
						<div class="ui-g-12 ui-lg-3">
							<p:selectOneRadio
								value="#{contasReceberBean.campoBuscaTipoConta}">
								<f:selectItem itemLabel="Pendente" itemValue="P" />
								<f:selectItem itemLabel="Lançado" itemValue="L" />
								<f:selectItem itemLabel="Pago" itemValue="PA" />
								<p:ajax event="change" update="@form"
									listener="#{contasReceberBean.busca}" />
							</p:selectOneRadio>
						</div>
						<div class="ui-g-12 ui-lg-3">
							<div class="ui-inputgroup">
								<p:inputText
									value="#{contasReceberBean.campoBuscaContasReceber}"
									placeholder="Buscar pelo Nome do Paciente" id="inputNome"
									style="height:40px; font-size: large !important; font-weight: bold; " />
								<p:commandButton style="height:40px; " styleClass="btn btn-blue"
									icon="ui-icon-search" id="btnBuscatxt"
									actionListener="#{contasReceberBean.busca}"
									update=" inputNome,table,formPai:botoes" />
							</div>
						</div>

					</div>
				</p:panel>
				<p:panel>
					<div class="ui-g">
						<p:dataTable value="#{contasReceberBean.lstContasReceber}" var="d"
							emptyMessage="Não Há Registros" styleClass="table.gridtable"
							rowKey="#{d.idContasReceber}" selectionMode="single" id="table"
							paginator="true" rows="8" 
							selection="#{contasReceberBean.contasReceberModel}">

							<p:ajax event="rowSelect"
								listener="#{contasReceberBean.onRowSelect}"
								update="table, formPai:botoes" />

							<p:column headerText="Status" priority="1"
								style="overflow: hidden;text-align: center; font-size: medium;width: 8%">
								<p:outputLabel value="Pendente" rendered="#{d.status eq 'P'}"
									style="color : red" />
								<p:outputLabel value="Lançada" rendered="#{d.status eq 'L'}"
									style="color : blue" />
								<p:outputLabel value="Pago" rendered="#{d.status eq 'PA'}"
									style="color : green" />
							</p:column>


							<p:column headerText="Usuário"
								style="overflow: hidden;text-align: center; font-size: large;"
								width="10%">
								<p:outputLabel value="#{d.login.login.toUpperCase()}" />
							</p:column>

							<p:column headerText="Paciente"
								style="text-align: left; font-size: large" width="30%">
								<p:outputLabel value="#{d.paciente.pessoa.pessoaNome}" />
								<p:outputLabel value=" | #{d.paciente.convenio.nomeConvenio}" />
							</p:column>
							<p:column headerText="Pagamento"
								style="text-align: center; font-size: large" width="10%">
								<p:outputLabel value="#{d.dataPagamento}"
									rendered="#{d.dataPagamento != null}">
									<f:convertDateTime pattern="dd/MM/yyyy HH:mm" locale="pt_BR"
										timeZone="America/Sao_Paulo" />
								</p:outputLabel>

								<p:outputLabel value="Consulta não quitada"
									rendered="#{d.dataPagamento == null}" style="color:red" />
							</p:column>
							
							<p:column headerText="Entrada"
								style="text-align: right; font-size: large" width="8%">
								<p:outputLabel style="color: red" value="R$ #{d.valorEntrada}" />
							</p:column>
							
							<p:column headerText="Desconto"
								style="text-align: right; font-size: large" width="8%">
								<p:outputLabel style="color: red" value="R$ #{d.valorDesconto}" />
							</p:column>
							
							<p:column headerText="Valor"
								style="text-align: right; font-size: large" width="8%">
								<p:outputLabel style="color: red" value="R$ #{d.valorConsulta}" />
							</p:column>

							<p:column headerText="Ações" width="10%">
								<p:commandButton
									rendered="#{d.tipoPagamento eq 'PAR' or (d.tipoPagamento eq 'ESP')}"
									action="#{contasReceberBean.selecionarBusca(contasReceberBean.contasReceberModel)}"
									update=":formulario:tableParcelas,:pagamentoEspecial:tableEspecial"
									ajax="true" value="Parcelas" immediate="true" icon="ui-icon-transferthick-e-w" iconPos="left"
									style="color:white; background: green; font-weight: bold ;font-size:large" >
									 
									<f:setPropertyActionListener value="#{d}"
										target="#{contasReceberBean.contasReceberModel}" />
								</p:commandButton>


								<p:commandButton
									rendered="#{d.tipoPagamento eq 'AV' or (!d.tipoPagamento eq 'CC') or (!d.tipoPagamento eq 'CD')}" 
									action="#{contasReceberBean.pagamentoUnico}"
									update=":formulario:tableParcelas,:pagamentoEspecial:tableEspecial"
									ajax="true" value="Pagar" immediate="true" icon="fa fa-usd"
									style="color:white; background: green; font-weight: bold ;font-size:large">
									<f:setPropertyActionListener value="#{d}"
										target="#{contasReceberBean.contasReceberModel}" />
										<p:confirm message="Deseja fazer o pagamento ?" icon="ui-icon-mail-closed" />
								</p:commandButton>
								
								<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
									<div align="center">
										<p:commandButton value="Sim" type="button"
											styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
							
										<p:commandButton value="Não" type="button"
											styleClass="ui-confirmdialog-no" icon=" ui-icon-close" />
									</div>
								</p:confirmDialog>
							</p:column>
						</p:dataTable>
					</div>
				</p:panel>
			</div>
		</div>
	</p:panel>
</body>
</html>


<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:util="http://java.sun.com/jsf/composite/componentes"
	template="/WEB-INF/template.xhtml">

	<ui:define name="title">Receber Consulta</ui:define>

	<ui:define name="head">

		<style type="text/css">
.ui-datatable thead th, .ui-datatable tfoot td {
	text-align: center;
	font-size: large;
}

.ui-lg-12.centralizar {
	margin: 0 auto !important;
	height: auto;
	width: 100% text-align: center;
	float: none !important;
	position: inherit;
}

.tamanho {
	height: 150px !important;
}

.ui-fluid .ui-inputtext {
	width: 100%;
	/* height: 35px; */
	font-size: large;
	text-align: center;
	color: black;
}

.ui-g label {
	font-size: medium;
	color: #2e6e9e;
	font-weight: bold;
}

.subtitulo {
	font-weight: bold;
	font-size: 20px !important;
	color: black !important;
}

.
ui-fluid .ui-autocomplete, .ui-fluid .ui-autocomplete-input {
	width: 100%;
	height: 35px;
	font-size: large;
	text-align: center;
	color: black;
}

.ui-fluid .ui-inputtextarea {
	width: 100%;
	/*height: 150px !important;*/
}

.ui-inputfield {
	margin: 0;
	outline: medium none;
	padding: 4px;
	font-weight: bold;
	height: 35px;
	font-size: medium !important;
}

.ui-autocomplete-input.ui-autocomplete-dd-input {
	padding-right: 2.4em;
	/*width: 100% !important;*/
}
.card {
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;
    border-radius: 2px;
    background: #fcfdfd ;
    padding: 16px;
    box-sizing: border-box;
    margin-bottom: 16px;
}
</style>

	</ui:define>
	<ui:define name="content">
		<h:form id="formPai">
			<div align="center">
				<p:panel id="panel" header="Menu">
					<!-- Botão Contas Pendentes -->
					<p:commandButton value="Contas Pendentes"
						rendered="#{contasReceberBean.estado ne 'P'}"
						style="height:40px;width:200px; background-color: seagreen; 
							background: seagreen; color:white !important"
						ajax="true" immediate="true" id="buttonAtestado"
						icon="fa fa-info-circle" iconPos="right"
						action="#{contasReceberBean.redirecionarFindEntidade}"
						update="@form">
					</p:commandButton>

					<!-- Botão Pagamento -->
					<p:commandButton value="Pagamento"
						rendered="#{contasReceberBean.contasReceberModel.status eq 'P' and (
						contasReceberBean.contasReceberModel.idContasReceber > 0)}"
						style="height:40px;width:170px; 
							background-color: darkcyan; background: darkcyan; color:white !important"
						ajax="true" immediate="true" id="buttonPagamento"
						icon="fa fa-info-circle" iconPos="right"
						onclick="PF('relancarPagamento').show()" update="@form">
						<f:setPropertyActionListener value="#{d}"
							target="#{contasReceberBean.contasReceberModel}" />
					</p:commandButton>

					<p:commandButton
						style="height:40px;width:170px; 
							background-color: blue; background: blue; color:white !important"
						rendered="#{contasReceberBean.contasReceberModel.status eq 'L'  and
						(contasReceberBean.contasReceberModel.idContasReceber > 0)}"
						value="Editar Pagamento" onclick="PF('relancarPagamento').show()">

					</p:commandButton>

					<!--  Botão Estorno 
					<p:commandButton value="Estorno"
						rendered="#{contasReceberBean.contasReceberModel.status eq 'L' and
						contasReceberBean.contasReceberModel.idContasReceber > 0 and 
						loginBean.usuarioLogadoSecurity eq 'ate'}"
						style="height:40px;width:170px; 
							background-color: darkcyan; background: darkcyan; color:white !important"
						ajax="true" immediate="true" id="buttonEstorno"
						icon="fa fa-info-circle" iconPos="right"
						action="#{contasReceberBean.relancarContasReceberAtendente}"
						update="@form">
					</p:commandButton>

					Botão Estorno
					<p:commandButton value="Estorno ADM"
						rendered="#{contasReceberBean.contasReceberModel.status eq 'L' and
						contasReceberBean.contasReceberModel.idContasReceber > 0 and 
						loginBean.usuarioLogadoSecurity eq 'admin'}"
						style="height:40px;width:170px; 
							background-color: darkcyan; background: darkcyan; color:white !important"
						ajax="true" immediate="true" id="buttonEstornoADM"
						icon="fa fa-info-circle" iconPos="right"
						action="#{contasReceberBean.relancarContasReceberAdm}"
						update="@form">
					</p:commandButton>
 -->

					<!-- <p:commandButton value="Tabela de Preço"
						style="height:40px;width:170px; 
							background-color: darkcyan; background: darkcyan; color:white !important"
						ajax="true" immediate="true" id="buttonTabelaPreco"
						icon="fa fa-info-circle" iconPos="right"
						action="#{contasReceberBean.mudaEstadoTabelaPreco}" update="@form">
					</p:commandButton> -->
				</p:panel>
			</div>

			<!-- FORM PENDENTES -->
			<ui:include src="/financeiro/receber/buscaContasReceber.xhtml" />

			<!-- FORM PAGAMENTO -->
			<ui:include src="/financeiro/receber/pagamento.xhtml" />
		</h:form>



		<!-- DIALOG -->
		<p:dialog widgetVar="mostraParcelas" id="mostraParcelas" modal="true"
			resizable="false" height="250" width="800" dynamic="true"
			onHide="atualizarAoSair()" appendToBody="@body" header="Parcelas">
			<h:form id="formulario">
				<p:remoteCommand name="atualizarAoSair" update="@form"
					actionListener="#{contasReceberBean.busca}" />

				<p:commandButton
					style="height:40px;width:200px; background-color: green; 
							background: green; color:white !important"
					rendered="#{contasReceberBean.parcelaPagarModel.situacao eq 'P' and
					contasReceberBean.parcelaPagarModel.idParcela > 0}"
					value="Pagar Parcela" update="tableParcelas"
					actionListener="#{contasReceberBean.pagarParcela}" />

				<p:commandButton
					style="height:40px;width:200px; background-color: red; 
							background: red; color:white !important"
					rendered="#{contasReceberBean.parcelaPagarModel.situacao eq 'PA' and
								contasReceberBean.contasReceberModel.status eq 'L' and
								loginBean.usuarioLogadoSecurity eq 'admin' or
								loginBean.usuarioLogadoSecurity eq 'ate' and
								contasReceberBean.parcelaPagarModel.idParcela > 0 }"
					value="Estornar Parcela" update="tableParcelas"
					actionListener="#{contasReceberBean.estornarParcelas}" />

				<p:commandButton
					style="height:40px;width:200px; background-color: red; 
							background: red; color:white !important"
					rendered="#{contasReceberBean.parcelaPagarModel.situacao eq 'PA' and
								contasReceberBean.contasReceberModel.status eq 'PA'  and
								loginBean.usuarioLogadoSecurity eq 'admin' and
								contasReceberBean.parcelaPagarModel.idParcela > 0 }"
					value="Estornar Parcela de Conta Paga" update="tableParcelas"
					actionListener="#{contasReceberBean.estornarParcelasPagas}" />

				<p:dataTable value="#{contasReceberBean.lstParcelaPagarPendentes}"
					var="d" styleClass="table.gridtable" rowKey="#{d.idParcela}"
					selectionMode="single" id="tableParcelas" paginator="true" rows="8"
					selection="#{contasReceberBean.parcelaPagarModel}">

					<p:ajax event="rowSelect"
						listener="#{contasReceberBean.onRowSelectParcelas}"
						update="tableParcelas , @form" />

					<p:column headerText="Nº Parcela" priority="1"
						style="width:10%; text-align:center; ">
						#{d.numeroParcela}
					</p:column>
					<p:column headerText="Vencimento" priority="1"
						style="text-align:center; width: 20% ; font-size: 18px">
						<p:outputLabel value="#{d.dataVencimento}">
							<f:convertDateTime timeZone="America/Sao_Paulo" />
						</p:outputLabel>
					</p:column>
					<p:column headerText="Pagamento" priority="1"
						style="text-align:center; width: 20% ; font-size: 18px">
						<p:outputLabel value="#{d.dataPagamento}">
							<f:convertDateTime timeZone="America/Sao_Paulo" />
						</p:outputLabel>
					</p:column>
					<p:column headerText="Situação" priority="1"
						style="width: 20%; text-align:center; font-size: 18px">
						<p:outputLabel value="Pendente" rendered="#{d.situacao eq 'P'}"
							style="color : green" />
						<p:outputLabel value="Paga" rendered="#{d.situacao eq 'PA'}"
							style="color : red" />
					</p:column>

					<p:column headerText="Valor" priority="1"
						style="text-align:right; width: 15%; font-size: 18px">
						R$ #{d.valorBruto}
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog widgetVar="relancarPagamento" id="relancarPagamento"
			modal="true" resizable="false" height="350" width="900"
			responsive="true" dynamic="true" appendToBody="@body"
			header="Relançar?">
			<div class="ui-fluid">
				<div class="ui-g">
					<div class="ui-g-12">
						<div class="card card-w-title">
							<div class="ui-g-12 ui-lg-12">
								<h:form>
									<div class="ui-g">
										<div class="ui-g-12 ui-lg-5">
											<h:outputLabel value="Paciente: " />
											<br />
											<h:outputLabel
												value="#{contasReceberBean.contasReceberModel.paciente.pessoa.pessoaNome}" />
										</div>

										<div class="ui-g-12 ui-lg-3">
											<h:outputLabel value="Valor Consulta" />
											<br />
											<p:outputLabel required="true" style="font-size: medium;"
												value="R$ #{contasReceberBean.contasReceberModel.valorConsulta}" />
										</div>

										<div class="ui-g-12 ui-lg-4">
											<h:outputLabel value="Valor com Desconto/Entrada" />
											<br />
											<p:outputLabel id="valorComDesconto" required="true"
												style="font-size: medium;"
												value="R$ #{contasReceberBean.contasReceberModel.valorComDesconto}">

											</p:outputLabel>
										</div>
									</div>
									<hr />
									<div class="ui-g">
										<div class="ui-g-12 ui-lg-3">
											<h:outputLabel value="Desconto" />
											<br />
											<p:inputNumber decimalPlaces="2" symbol="R$"
												symbolPosition="p" emptyValue="0" style="font-size: medium"
												value="#{contasReceberBean.contasReceberModel.valorDesconto}">
												<p:ajax event="change" update="valorComDesconto,par"
													listener="#{contasReceberBean.fazerDesconto}" />
											</p:inputNumber>
										</div>
										<div class="ui-g-12 ui-lg-3">
											<h:outputLabel value="Entrada" />
											<br />
											<p:inputNumber decimalPlaces="2" symbol="R$"
												symbolPosition="p" emptyValue="0" style="font-size: medium"
												value="#{contasReceberBean.contasReceberModel.valorEntrada}">
												<p:ajax event="change" update="valorComDesconto,par"
													listener="#{contasReceberBean.fazerDesconto}" />

											</p:inputNumber>
										</div>
										<div class="ui-g-12 ui-lg-6 ui-sm-12">
											<h:outputLabel value="Forma de Pagamento" />
											<br />
											<p:autoComplete id="pagamento"
												completeMethod="#{auxController.completeFormaPagamento}"
												forceSelection="true" converter="entityConverter" var="a"
												itemLabel="#{a.nomePagamento}" itemValue="#{a}"
												value="#{contasReceberBean.contasReceberModel.formaPagamento}"
												minQueryLength="2" dropdown="true" maxResults="30"
												required="false"
												requiredMessage="Informe uma uma forma de pagamento">
												<p:column id="p">
													<h:outputText value="#{a.nomePagamento.toUpperCase()}" />
												</p:column>
												<p:column>
													<h:outputText value="#{a.idFormaPagamento}" />
												</p:column>
												<p:ajax event="itemSelect" update="parcelas,valorParcela" listener="#{contasReceberBean.fazerValorAvista}"/>
											</p:autoComplete>
										</div>
									</div>
									<div class="ui-g">
										<div class="ui-g-12 ui-lg-6">
											<p:outputPanel id="parcelas">
												<h:outputLabel value="Parcela(s)"
													rendered="#{contasReceberBean.contasReceberModel.formaPagamento.idFormaPagamento eq '1'}" />
												<br />
												<p:selectOneButton style="height: 35px"
													value="#{contasReceberBean.contasReceberModel.quantidadeParcelas}"
													rendered="#{contasReceberBean.contasReceberModel.formaPagamento.idFormaPagamento eq '1'}">
													<f:selectItem itemLabel="1x" itemValue="1" />
													<f:selectItem itemLabel="2x" itemValue="2" />
													<f:selectItem itemLabel="3x" itemValue="3" />
													<f:param name="parametro"
														value="#{contasReceberBean.contasReceberModel.quantidadeParcelas}" />
													<p:ajax event="change" update="par"
														listener="#{contasReceberBean.fazerParcelas(contasReceberBean.contasReceberModel.quantidadeParcelas)}" />
													<!-- <p:ajax event="itemSelect" update="par"
														listener="#{contasReceberBean.fazerParcelas(contasReceberBean.contasReceberModel.quantidadeParcelas)}" /> -->
												</p:selectOneButton>
											</p:outputPanel>
										</div>
										<div class="ui-g-12 ui-lg-6">
										<p:outputLabel id="valorParcela" rendered="#{contasReceberBean.contasReceberModel.formaPagamento.idFormaPagamento != null}">
												<h:outputLabel value="Valor da Parcela" rendered="#{contasReceberBean.contasReceberModel.formaPagamento.idFormaPagamento eq '1'}" />
												<h:outputLabel value="Valor da Consulta" rendered="#{contasReceberBean.contasReceberModel.formaPagamento.idFormaPagamento ne '1'}" />
											<br />
											<p:inputNumber id="par" decimalPlaces="2" symbol="R$"
												symbolPosition="p"
												value="#{contasReceberBean.contasReceberModel.valorParcelado}"
												style="font-size: medium;" />
										</p:outputLabel>
										</div>
									</div>
									<hr />
									<div class="ui-g" align="center">
										<div class="ui-g-12 ui-lg-12">
											<p:commandButton value="Lançar"
												style="height:40px;width:130px; background-color: seagreen; background: seagreen; color:white !important"
												oncomplete="PF('relancarPagamento').hide()"
												actionListener="#{contasReceberBean.editarPagamento}" />
										</div>
									</div>
								</h:form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</p:dialog>

	</ui:define>
</ui:composition>